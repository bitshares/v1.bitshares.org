!function(e){e.fn.bitsharesticker=function(r){function a(e,r,a){return"undefined"==typeof a||0===+a?Math[e](r):(r=+r,a=+a,isNaN(r)||"number"!=typeof a||a%1!==0?0/0:(r=r.toString().split("e"),r=Math[e](+(r[0]+"e"+(r[1]?+r[1]-a:-a))),r=r.toString().split("e"),+(r[0]+"e"+(r[1]?+r[1]+a:a))))}function i(e,r){return a("round",e,-1*r)}function s(){e.ajax({url:r.source+"?assets="+_,type:"post",dataType:"json",timeout:15e3,error:function(r,a,i){S=!0,e(".bitsharesticker-feed").html("<span><font color='red'>Error!</font> Could not download price data. Trying again in 5 seconds...</span>")},complete:function(){var e=w;S||(e=r.updateInterval),setTimeout(function(){s()},1e3*e)},success:function(r,a,i){if(r){var s=c(r);if(S){S=!1;var n=d(s);e(".bitsharesticker-feed").html(n)}else o(s)}}})}function n(){var e=u.position().left;e<-1*u.width()&&u.css("left",f.width()),g>0?u.animate({left:"-=1px"},g,"linear",n):n()}function t(){var e=new Array,a=new Array;_="";for(var i=r.currencyPrimary.replace(/\s/g,""),s=i.split(","),n=r.currencySecondary.replace(/\s/g,""),t=r.currencySecondary.split(","),c=0;c<s.length;c++){-1===_.indexOf(s[c])&&(_+=s[c]+",");for(var o=0;o<t.length;o++){-1===_.indexOf(t[o])&&(_+=t[o]+",");var p=s[c]+t[o],d=t[o]+s[c];e[d]||e[p]||(e[p]=1,a.push({primary:s[c],secondary:t[o]}))}}return _.length>0&&(_=_.slice(0,-1)),a}function c(e){for(var r=[],a=0;a<e.length;a++){var i=[];i.open_price=e[a].opening_price?e[a].opening_price:e[a].median_price,i.median_price=e[a].median_price,r[e[a].asset]=i}return r}function o(r){var a=new Date;e("#date").text(a.toString()),e.each(k,function(a,s){var n=s.primary+s.secondary,t=b[s.secondary],c=2;t&&(c=t.decimal_digits);var o=0;"BTS"===s.primary?(o=r[s.secondary].median_price,c=b[s.primary].decimal_digits):"BTS"===s.secondary?(o=1/r[s.primary].median_price,c=b[s.secondary].decimal_digits):r[s.primary]&&r[s.secondary]&&(o=r[s.secondary].median_price/r[s.primary].median_price);var p=i(o,c),d=i(parseFloat(e("#"+n+" #value").text()),c);if(d!=p){var l=0;"BTS"===s.primary?l=r[s.secondary].open_price:"BTS"===s.secondary?l=1/r[s.primary].open_price:r[s.primary]&&r[s.secondary]&&(l=r[s.secondary].open_price/r[s.primary].open_price);var y=o-l,u=i(y/l*100,2),f="";t&&(f=t.symbol);var m=s.primary+"/"+s.secondary+" "+f+'<b id="value">'+p+"</b>";y>0?m+='<b class="up">&nbsp;<b class="change">&nbsp;'+i(y,c)+'</b><b class="pct">&nbsp;('+u+'%)</b>&nbsp;<i class="fa fa-caret-up"></i></b>':0>y&&(m+='<b class="down">&nbsp;<b class="change">&nbsp;'+i(y,c)+'</b><b class="pct">&nbsp;('+u+'%)</b>&nbsp;<i class="fa fa-caret-down"></i></b>'),m+="&nbsp;&nbsp;",e("#"+n).html(m)}})}function p(){e.ajax({url:"Common-Currency.json",type:"post",dataType:"json",timeout:15e3,error:function(r,a,i){e(".bitsharesticker-feed").html("<span><font color='red'>Error!</font> Could not download Currency template file. Please refresh your browser to try again...</span>")},success:function(e,r,a){e&&(b=e,setTimeout(function(){s()},1e3*w))}})}function d(r){var a="",s=new Date;return a+="<span><span id='date'>"+s.toString()+"</span>&nbsp;&nbsp;",e.each(k,function(e,s){var n=b[s.secondary],t=2;n&&(t=n.decimal_digits),a+='<span id="'+s.primary+s.secondary+'">';var c=0;"BTS"===s.primary?(c=r[s.secondary].median_price,t=b[s.primary].decimal_digits):"BTS"===s.secondary?(c=1/r[s.primary].median_price,t=b[s.secondary].decimal_digits):r[s.primary]&&r[s.secondary]&&(c=r[s.secondary].median_price/r[s.primary].median_price);var o=0;"BTS"===s.primary?o=r[s.secondary].open_price:"BTS"===s.secondary?o=1/r[s.primary].open_price:r[s.primary]&&r[s.secondary]&&(o=r[s.secondary].open_price/r[s.primary].open_price);var p=0,d=0;o>0&&c>0&&(p=c-o,d=i(p/o*100,2));var l="";n&&(l=n.symbol),a+=s.primary+"/"+s.secondary+" "+l+'<b id="value">'+i(c,t)+"</b>",p>0?a+='<b class="up">&nbsp;<b class="change">&nbsp;'+i(p,t)+'</b><b class="pct">&nbsp;('+d+'%)</b>&nbsp;<i class="fa fa-caret-up"></i></b>':0>p&&(a+='<b class="down">&nbsp;<b class="change">&nbsp;'+i(p,t)+'</b><b class="pct">&nbsp;('+d+'%)</b>&nbsp;<i class="fa fa-caret-down"></i></b>'),a+="&nbsp;&nbsp;</span>"}),a+="Rates updated every 5 minutes&nbsp;&nbsp;",a+='Powered by <a href="http://bitshares.org" target="_blank">Bitshares.org</a>...&nbsp;&nbsp;</span>',e(a)}function l(){var r="";return r+='<div class="bitsharesticker">',r+='<div class="bitsharesticker-container">',r+='<div class="bitsharesticker-container-left"></div>',r+='<div class="bitsharesticker-container-content">',r+='<div class="bitsharesticker-username"><a href="#">Bitshares Ticker</a></div>',r+='<div class="bitsharesticker-bitshares-link"><a href="http://bitshares.org" target="_blank">Bitshares.org</a></div>',r+='<div class="bitsharesticker-feedbox">',r+='<div class="bitsharesticker-feedbox-content">',r+='<div class="bitsharesticker-replace"></div>',r+="</div>",r+="</div>",r+="</div>",r+='<div class="bitsharesticker-container-right"></div>',r+="</div>",r+="</div>",e(r)}var b=null,r=e.extend({},e.fn.bitsharesticker.defaults,r),y,u,f,m,h,v,g=r.normalRate,_="",k=t(),w=5,S=!0;return this.each(function(){y=0==r.tickerOnly?l():e('<div class="bitsharesticker"><div class="bitsharesticker-replace"></div></div>'),e(this).append(y);var a="Loading... Please wait.";u=e('<ul class="bitsharesticker-feeds-list"><li class="bitsharesticker-feed">'+a+"</li></ul>"),f=e('<div class="bitsharesticker-overflow-container"></div>'),y.find("div.bitsharesticker-username a").attr("href","http://bitshares.org").html(r.title),f.wrapInner(u),y.find("div.bitsharesticker-replace").replaceWith(f),f.mouseover(function(){g=r.hoverRate}),f.mouseout(function(){g=r.normalRate}),u.css("left",f.width()),n(),p()})},e.fn.bitsharesticker.defaults={title:"",normalRate:10,hoverRate:100,tickerOnly:!1,source:"",currencyPrimary:"",currencySecondary:"",updateInterval:300}}(jQuery);